\chapter{Case-study: nieuwe oefening}\label{ch:nieuwe-oefening}

\lettrine{I}{n dit hoofdstuk} behandelen we het toevoegen van drie oefeningen in handleidingsstijl.
Elke oefening gebruikt een andere evaluatiemethode uit \cref{sec:oplossingen-beoordelen}.
We gaan er van uit dat de map voor de repo voor deze oefeningencollectie al bestaat.
Deze moet voldoen aan de mappenstructuur voor oefeningen, opgelegd door Dodona\footnote{Hier beschikbaar: \url{https://dodona-edu.github.io/en/references/exercise-directory-structure/}}.

\section{ISBN}\label{sec:isbn}

Bij de eerste oefening gebruiken we enkel ingebouwde evaluators.

\subsection{Voorbereiding}\label{subsec:voorbereiding}

We beginnen met het maken van een nieuwe map \texttt{isbn} in onze map voor de oefeningencollectie.
Vervolgens maken we in deze map een configuratiebestand \texttt{config.json} voor onze oefening, met deze inhoud:

\inputminted{json}{../../exercise/isbn/config-clean.json}

In dit bestand doen we drie belangrijke dingen:
\begin{enumerate}
    \item We geven onze oefening een naam.
    \item We duiden aan dat het om een Python-oefening gaat (zie \cref{ch:beperkingen-en-toekomstig-werk} voor waarom we dit doen).
    \item We zeggen dat ons testplan als naam \texttt{plan.json} heeft.
\end{enumerate}

\subsection{Opgave}\label{subsec:opgave}

In deze stap stellen we de opgave op.
Om dit deel kort te houden, gaan we er van uit dat de opgave al bestaat.
Maak een map \texttt{description} in onze oefeningenmap, en kopieer de opgavebestanden naar deze map.
Uiteindelijk moet deze map er zo uitzien:

\begin{minted}{text}
isbn
└── description
    ├── description.en.html
    ├── description.nl.html
    └── media
        └── ISBN.gif
\end{minted}

Om toch een idee te krijgen van waarover de oefening gaat, is hieronder een samenvatting van de opgave:

\begin{quote}
    \markdownInput{generated/isbn_description.md}
\end{quote}


\section{Testplan}\label{sec:isbn-testplan}

Nu komen we aan het belangrijkste deel van het opstellen van een oefening: het testplan.
Om te beginnen kunnen we even nadenken over hoe de structuur er zal uitzien.
We hebben twee functies die getest moeten worden.
Laten we de in- en uitvoer voor deze functies $X_i$ en $X_o$ noemen.
Aangezien elke functieoproep onafhankelijk is, kiezen we ervoor om ze in aparte contexten van het testplan te steken.
Verder kunnen we al zeggen dat elke context juist één testgeval zal hebben: de functieoproep.
Elk testgeval zal ook maar één test hebben, waar we de returnwaarde controleren.
Alle andere uitvoerkanalen mogen de standaardwaarde behouden (wat betekent dat er bv.\ geen exceptions mogen zijn, een lege standaardfoutstroom, de standaarduitvoerstroom wordt genegeerd, enz.).
We verdelen de contexten bovendien in twee tabbladen, een voor elke functies.
De structuur van het testplan ziet er dus als volgt uit:

\begin{itemize}
    \item Tabblad voor \texttt{is\_isbn}
           \begin{itemize}
               \item Context voor invoer $X_{i1}$ en uitvoer $X_{o1}$
               \item Context voor invoer $X_{i2}$ en uitvoer $X_{o2}$
               \item Context voor invoer $X_{i3}$ en uitvoer $X_{o3}$
               \item Context voor invoer $X_{i4}$ en uitvoer $X_{o4}$
               \item \ldots
           \end{itemize}
    \item Tabblad voor \texttt{are\_isbn}
    \begin{itemize}
        \item Context voor invoer $X_{i1}$ en uitvoer $X_{o1}$
        \item Context voor invoer $X_{i2}$ en uitvoer $X_{o2}$
        \item Context voor invoer $X_{i3}$ en uitvoer $X_{o3}$
        \item Context voor invoer $X_{i4}$ en uitvoer $X_{o4}$
        \item \ldots
    \end{itemize}
\end{itemize}

In plaats van dit testplan manueel te schrijven, kiezen we ervoor om een Python-scriptje te schrijven, dat dit testplan voor ons genereert.
Om te beginnen:
\begin{itemize}
    \item Kopieer \texttt{solution.py} naar de map \texttt{solution}.
    Dit is de voorbeeldoplossing.
    \item Kopieer \texttt{values.py} naar de map \texttt{preparation}.
    Deze module encodeert waarden in het serialisatieformaat.
    In de toekomst is dit misschien niet meer nodig, moest dit als Python-package gepubliceerd worden.
\end{itemize}

Maak nu een bestand in de map \texttt{preparation} genaamd \texttt{generator.py}.
Hieronder volgt het script dat het testplan genereert.
Het is rijkelijk voorzien van commentaar, zodat alles duidelijk is.

\inputminted{python}{../../exercise/isbn/preparation/generator.py}

\subsection{Afsluiting}\label{subsec:aflsuiting}

Op dit moment is de oefening klaar.
Ter controle: de complete mapstructuur van de uiteindelijke oefening wordt nog eens getoond in \cref{lst:mapstructuur-isbn}.
Nu rest nog enkel de oefening importeren in Dodona.
Is de oefening toegevoegd aan een bestaande repo, dan volstaat het om op de knop "Alle oefeningen opnieuw verwerken" te drukken.
Gaat het om een nieuwe oefeningenrepo, dan moet deze toegevoegd worden\footnote{De handleiding hiervoor staat op \url{https://dodona-edu.github.io/en/guides/new-exercise-repo/}}.

\begin{listing}
    \inputminted{text}{code/exercise-listing.txt}
    \caption{Finale mapstructuur van de oefening \acronym{ISBN}.}
    \label{lst:mapstructuur-isbn}
\end{listing}

